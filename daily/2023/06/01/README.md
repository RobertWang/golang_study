# Go æ¯æ—¥ä¸€é¢˜

> ä»Šæ—¥ï¼ˆ2023-06-01ï¼‰çš„é¢˜ç›®å¦‚ä¸‹

ä»Šå¤©ç»™ä¸¤é“ç±»ä¼¼çš„é¢˜ç›®ï¼Œæ³¨æ„ï¼Œæœ‰åŠæ•°ä»¥ä¸Šçš„äººå¯èƒ½ä¼šåšé”™ï¼

é¢˜ä¸€ï¼š

```golang
package main

func main() {
    var a int8 = -1
    var b int8 = -128 / a

    println(b)
}
```

é¢˜äºŒï¼š

```golang
package main

func main() {
    const a int8 = -1
    var b int8 = -128 / a

    println(b)
}
```

å®ƒä»¬åˆ†åˆ«è¾“å‡ºä»€ä¹ˆï¼Ÿè¯·å†™å‡ºä½ çš„ç­”æ¡ˆï¼Œèƒ½è§£é‡ŠåŸå› æœ€å¥½ã€‚

<details>
<summary style="cursor: pointer">ğŸ”‘ ç­”æ¡ˆè§£æï¼š</summary>
<div>

>   (ä¸ 2023-02-09 çš„é¢˜é‡å¤)

è¿™æ˜¯ç«™é•¿åœ¨å»å¹´åŒèŠ‚æœŸé—´å…¬ä¼—å·ã€Œpolarisxuã€ä¸Šå‘å¸ƒçš„é¢˜ç›®ã€‚

ç­”å¯¹çš„äººçœŸä¸å¤šï¼ˆåŠæ•°ä»¥ä¸Šç­”é”™äº†ï¼‰ï¼Œç‰¹åˆ«æ˜¯é¢˜ä¸€ï¼Œä¸€åŠä»¥ä¸Šç«Ÿç„¶æ˜¯ 128ï¼Œéš¾é“ä¸çŸ¥é“ int8 èƒ½è¡¨ç¤ºçš„èŒƒå›´å—ï¼Ÿ[-128, 127]ã€‚ä¸è¿‡ä¸ºä»€ä¹ˆç­”æ¡ˆæ˜¯ï¼šé¢˜ä¸€ -128ï¼Œé¢˜äºŒç¼–è¯‘é”™è¯¯ï¼Ÿ

å…¶å®è¿™æ˜¯ä¸€é“è®¡ç®—æœºåŸºç¡€é¢˜ã€‚

å…ˆçœ‹çœ‹ç½‘å‹ Jayce çš„è§£é‡Šï¼šç¬¬ä¸€é¢˜æ˜¯ -128ï¼ˆuntyped constï¼‰/ -1 (int8 var)ï¼Œuntyped éšå¼è½¬æ¢ä¸º int8ï¼Œåˆšå¥½åœ¨èŒƒå›´å†…ï¼Œç»“æœæ˜¯ 128 ï¼Œæº¢å‡º int8 çš„èŒƒå›´ã€‚å› ä¸ºç»“æœä¸æ˜¯å¸¸é‡ï¼Œå…è®¸æº¢å‡ºï¼Œæœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œå˜æˆäº†è¡¥ç ï¼Œåˆšå¥½åˆæ˜¯ -128ã€‚ ç¬¬äºŒé¢˜ -128 å’Œ -1 éƒ½æ˜¯ constï¼Œç›´æ¥åœ¨ç¼–è¯‘æ—¶æ±‚å€¼ï¼Œuntyped çš„ -128 éšå¼è½¬ int8ï¼Œç»“æœä¸º 128ï¼Œä»ç„¶æ˜¯ä¸€ä¸ª constã€‚const è½¬æ¢æ—¶ä¸å…è®¸æº¢å‡ºï¼Œç¼–è¯‘é”™è¯¯ã€‚ å…¶å®å·®åˆ«å°±æ˜¯è¡¨è¾¾å¼çš„å€¼ï¼Œé¢˜ä¸€ä¸æ˜¯å¸¸é‡é¢˜äºŒæ˜¯ï¼Œå¸¸é‡ç±»å‹è½¬æ¢ä¸å…è®¸æº¢å‡ºå truncateã€‚

### å…³äºè¡¥ç 

å¦‚æœä½ å¿˜äº†è¡¥ç ï¼ˆ`Two's Complement`ï¼Œ2 çš„è¡¥ç ï¼Œä¸€èˆ¬ç›´æ¥ç§°ä¸ºè¡¥ç ï¼‰ï¼Œè¿™é‡Œç®€å•åšä¸ªè¯´æ˜ã€‚

å…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼šåœ¨è®¡ç®—æœºå†…éƒ¨ -1 äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ä»€ä¹ˆï¼ˆå‡å¦‚ä¸º int8ï¼‰ï¼Ÿ

æˆ‘ä»¬å¾ˆå®¹æ˜“è¿™ä¹ˆæƒ³ï¼š1 çš„äºŒè¿›åˆ¶æ˜¯ 00000001ï¼Œè€Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œå› æ­¤ -1 æ˜¯ 10000001ã€‚å› ä¸º 1 + (-1) = 0ï¼Œä½† 00000001 + 10000001 = 10000010ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªç»“æœä¸æ˜¯ 0ã€‚è¿™æ˜¯åŸç è¡¨ç¤ºã€‚

![åŸç å½¢å¼](../../02/09/complement01.png)

æ‰€ä»¥ï¼Œè®¡ç®—æœºå†…éƒ¨é‡‡ç”¨è¡¥ç ï¼ˆTwo's Complementï¼‰è¡¨ç¤ºè´Ÿæ•°ã€‚è¡¥ç æ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿä¸€èˆ¬åˆ†ä¸¤æ­¥ï¼š

![-1çš„è¡¥ç è¡¨ç¤º](../../02/09/complement01.png)

- ç¬¬ä¸€æ­¥ï¼Œæ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½éƒ½å–ç›¸åå€¼ï¼Œ0 å˜æˆ 1ï¼Œ1 å˜æˆ 0ã€‚æ¯”å¦‚ï¼Œ00000001 çš„ç›¸åå€¼å°±æ˜¯ 11111110ã€‚
- ç¬¬äºŒæ­¥ï¼Œå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„å€¼åŠ  1ã€‚11111110 å°±å˜æˆ 11111111ã€‚

![è¡¥ç å½¢å¼çš„åŠ æ³•](../../02/09/complement01.png)

å…³äºåŸç ã€åç å’Œè¡¥ç ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[https://www.cnblogs.com/zhangziqiu/archive/2011/03/30/ComputerCode.html](https://www.cnblogs.com/zhangziqiu/archive/2011/03/30/ComputerCode.html)ï¼Œå¾ˆè¯¦ç»†ã€‚

### é¢˜è§£

#### å…ˆçœ‹é¢˜ä¸€

å› ä¸º `var b int8 = -128 / a` ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå› æ­¤ untyped å¸¸é‡ -128 éšå¼è½¬æ¢ä¸º int8 ç±»å‹ï¼ˆå³å’Œ a çš„ç±»å‹ä¸€è‡´ï¼‰ï¼Œæ‰€ä»¥ `-128 / a` çš„ç»“æœæ˜¯ int8 ç±»å‹ï¼Œå€¼æ˜¯ 128ï¼Œè¶…å‡ºäº† int8 çš„èŒƒå›´ã€‚å› ä¸ºç»“æœä¸æ˜¯å¸¸é‡ï¼Œå…è®¸æº¢å‡ºï¼Œ128 çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 10000000ï¼Œæ­£å¥½æ˜¯ -128 çš„è¡¥ç ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€é¢˜çš„ç»“æœæ˜¯ -128ã€‚

>   å…³äºæ•´æ•°æº¢å‡ºçš„ Go è¯­è¨€è§„èŒƒè¯´æ˜ï¼š[https://hao.studygolang.com/golang_spec.html#id158](https://hao.studygolang.com/golang_spec.html#id158)ã€‚

åœ¨ Go è¯­è¨€è§„èŒƒä¸­å…³äºæ•´æ•°è¿ç®—æœ‰è¿™æ ·çš„è¯´æ˜ï¼š[https://hao.studygolang.com/golang_spec.html#id327](https://hao.studygolang.com/golang_spec.html#id327)

>   å¯¹äºä¸¤ä¸ªæ•´æ•°å€¼ x å’Œ y ï¼Œå…¶æ•´æ•°å•† q = x / y å’Œä½™æ•° r = x % y æ»¡è¶³å¦‚ä¸‹å…³ç³»ï¼š
>
>   x = q*y + r ä¸” |r| < |y|

>   è¿™ä¸ªè§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¦‚æœå¯¹äº x çš„æ•´æ•°ç±»å‹æ¥è¯´ï¼Œè¢«é™¤æ•° x æ˜¯è¯¥ç±»å‹ä¸­æœ€è´Ÿçš„é‚£ä¸ªå€¼ï¼Œé‚£ä¹ˆï¼Œå› ä¸º è¡¥ç  çš„ æ•´æ•°æº¢å‡º ï¼Œå•† q = x / -1 ç­‰äº x ï¼ˆå¹¶ä¸” r = 0 ï¼‰ã€‚

æ‰€ä»¥ä¾‹å¤–æƒ…å†µæœ‰ï¼š

ç±»å‹ | x, q çš„å€¼
-- | --
int8 | -128
int16 | -32768
int32 | -2147483648
int64 | -9223372036854775808

#### å†çœ‹é¢˜äºŒ

å¯¹äº `var b int8 = -128 / a`ï¼Œå› ä¸º a æ˜¯ int8 ç±»å‹å¸¸é‡ï¼Œæ‰€ä»¥ `-128 / a` æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œåœ¨ç¼–è¯‘å™¨è®¡ç®—ï¼Œç»“æœå¿…ç„¶ä¹Ÿæ˜¯å¸¸é‡ã€‚å› ä¸º a çš„ç±»å‹æ˜¯ int8ï¼Œå› æ­¤ -128 ä¹Ÿä¼šéšå¼è½¬ä¸º int8 ç±»å‹ï¼Œ128 è¿™ä¸ªç»“æœè¶…è¿‡äº† int8 çš„èŒƒå›´ï¼Œä½†å¸¸é‡ä¸å…è®¸æº¢å‡ºï¼Œå› æ­¤ç¼–è¯‘æŠ¥é”™ã€‚

### æ€»ç»“

è¿™é¢˜å¹¶é Go ç‹¬æœ‰ï¼Œè€Œæ˜¯è®¡ç®—æœºçš„åŸºç¡€ã€‚æ¯”å¦‚ç›¸åº”çš„ C è¯­è¨€ç¨‹åºï¼Œç»“æœå’Œ Go å¯¹åº”ç¨‹åºæ˜¯ä¸€æ ·çš„ã€‚

```c
// å¯¹åº”é¢˜ä¸€
#include <stdio.h>

int main() {
        char a = -1;
        char b = -128 / a;

        printf("%d\n", b);

        return 0;
}
```

ç»“æœ -128ã€‚

```c
// å¯¹åº”é¢˜äºŒ
#include <stdio.h>

int main() {
        const char a = -1;
        char b = -128 / a;

        printf("%d\n", b);

        return 0;
}
```

ç¼–è¯‘æŠ¥é”™ã€‚

ç­”æ¡ˆè§£ææ¥è‡ªï¼š[https://polarisxu.studygolang.com/posts/basic/complement/](https://polarisxu.studygolang.com/posts/basic/complement/)ã€‚

</div>
</details>
